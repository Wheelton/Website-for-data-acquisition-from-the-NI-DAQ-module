<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NI DAQ Control Dashboard</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîå</text></svg>">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/static/css/dashboard.css?v=18">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîå NI DAQ Control Dashboard</h1>
            <p class="subtitle">Website for Data Acquisition from NI DAQ Module</p>
        </div>

        <!-- Schematic Toggle Button -->
        <div style="text-align: center; margin: 20px 0;">
            <button class="toggle-btn" onclick="toggleSchematic()" style="padding: 12px 24px; font-size: 16px;">
                <span id="toggleText">üìê Show Schematic</span>
            </button>
        </div>

        <!-- Circuit Schematic Section -->
        <div class="schematic-section" id="schematicSection" style="display: none;">
            <div class="schematic-toggle">
                <button class="toggle-btn" onclick="toggleSchematicView()">
                    <span id="toggleViewText">üìã Extended View</span>
                </button>
            </div>
            <h2>üìê Circuit Schematic</h2>
            <div class="schematic-container" id="schematicContainer">
                <img src="/static/schematic.png" alt="DAQ Circuit Schematic" id="schematicImage" class="schematic-img"
                     onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'400\'%3E%3Crect width=\'800\' height=\'400\' fill=\'%23f0f0f0\'/%3E%3Ctext x=\'400\' y=\'200\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'20\' fill=\'%23666\'%3ESchematic image not found%3C/text%3E%3Ctext x=\'400\' y=\'230\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'14\' fill=\'%23999\'%3EPlease save your schematic as static/schematic.png%3C/text%3E%3C/svg%3E';">
                <div class="schematic-info">
                    <strong>‚ÑπÔ∏è System Components:</strong><br>
                    ‚Ä¢ Power Supply: 230V AC / 5V+ DC<br>
                    ‚Ä¢ Channels: CH1-CH4 (differential inputs)<br>
                    ‚Ä¢ Relay Modules: ZS1, ZS2 (switching control)<br>
                    ‚Ä¢ Capacitors: Cs1-Cs4 with relay switching (ZK modules)<br>
                    ‚Ä¢ Current Measurement: ADC channels with shunt resistors<br>
                    ‚Ä¢ Test Configuration: Multiple switching combinations for different measurement scenarios
                </div>
            </div>
        </div>

        <!-- Circuit Type Selection -->
        <div class="circuit-selection-section">
            <h2>‚ö° Select Circuit Type</h2>
            <p class="selection-subtitle">Choose one of the circuit configurations below to proceed with your measurement</p>
            
            <div class="circuit-grid">
                <!-- RL Circuit -->
                <div class="circuit-card" id="circuit-rl" onclick="selectCircuit('rl')">
                    <h3>RL Circuit</h3>
                    <div class="circuit-image-container">
                        <img src="/static/circuit-rl.png" alt="RL Circuit Diagram" class="circuit-image"
                             onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'200\'%3E%3Crect width=\'300\' height=\'200\' fill=\'%23f0f0f0\'/%3E%3Ctext x=\'150\' y=\'100\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'16\' fill=\'%23999\'%3ERL Circuit Image%3C/text%3E%3Ctext x=\'150\' y=\'120\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'12\' fill=\'%23bbb\'%3EPlace your image at static/circuit-rl.png%3C/text%3E%3C/svg%3E';">
                        <div class="circuit-info">
                            <p class="circuit-description">Series RL Circuit</p>
                            <p class="circuit-elements">Inductor (Ls) + Resistor (R1s/R2r)</p>
                        </div>
                    </div>
                </div>

                <!-- RC Circuit -->
                <div class="circuit-card" id="circuit-rc" onclick="selectCircuit('rc')">
                    <h3>RC Circuit</h3>
                    <div class="circuit-image-container">
                        <img src="/static/circuit-rc.png" alt="RC Circuit Diagram" class="circuit-image"
                             onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'200\'%3E%3Crect width=\'300\' height=\'200\' fill=\'%23f0f0f0\'/%3E%3Ctext x=\'150\' y=\'100\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'16\' fill=\'%23999\'%3ERC Circuit Image%3C/text%3E%3Ctext x=\'150\' y=\'120\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'12\' fill=\'%23bbb\'%3EPlace your image at static/circuit-rc.png%3C/text%3E%3C/svg%3E';">
                        <div class="circuit-info">
                            <p class="circuit-description">Series RC Circuit</p>
                            <p class="circuit-elements">Capacitor (Cs) + Resistor (R1s/R2r)</p>
                        </div>
                    </div>
                </div>

                <!-- RLC Circuit -->
                <div class="circuit-card" id="circuit-rlc" onclick="selectCircuit('rlc')">
                    <h3>RLC Circuit</h3>
                    <div class="circuit-image-container">
                        <img src="/static/circuit-rlc.png" alt="RLC Circuit Diagram" class="circuit-image"
                             onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'200\'%3E%3Crect width=\'300\' height=\'200\' fill=\'%23f0f0f0\'/%3E%3Ctext x=\'150\' y=\'100\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'16\' fill=\'%23999\'%3ERLC Circuit Image%3C/text%3E%3Ctext x=\'150\' y=\'120\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'12\' fill=\'%23bbb\'%3EPlace your image at static/circuit-rlc.png%3C/text%3E%3C/svg%3E';">
                        <div class="circuit-info">
                            <p class="circuit-description">Series RLC Circuit</p>
                            <p class="circuit-elements">Inductor (Ls) + Capacitor (Cs) + Resistor (R1s/R2r)</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Parameter Selection (shown when circuit is selected) -->
            <div class="parameter-section" id="parameterSection" style="display: none;">
                <h3>‚öôÔ∏è Component Parameters</h3>
                <p class="parameter-subtitle">Select parameter values for the circuit elements from the available options</p>
                
                <div class="parameter-grid" id="parameterGrid">
                    <!-- Inductance Ls -->
                    <div class="parameter-group" id="param-ls" style="display: none;">
                        <label for="select-ls">Inductance (Ls):</label>
                        <select id="select-ls" class="param-select">
                            <option value="">Select inductance...</option>
                            <option value="ls1">1/0.5 [mH/Œ©]</option>
                            <option value="ls2">10/2.5 [mH/Œ©]</option>
                            <option value="ls3">75.6/50.1 [mH/Œ©]</option>
                            <option value="ls4">~0.6/1 [H/Œ©]</option>
                        </select>
                        <div class="error-tooltip" id="error-ls">Please select an inductance value</div>
                    </div>
                    
                    <!-- Capacitance Cs -->
                    <div class="parameter-group" id="param-cs" style="display: none;">
                        <label for="select-cs">Capacitance (Cs):</label>
                        <select id="select-cs" class="param-select">
                            <option value="">Select capacitance...</option>
                            <option value="cs1">48 [ŒºF]</option>
                            <option value="cs2">9.5 [ŒºF]</option>
                            <option value="cs3">1 [ŒºF]</option>
                            <option value="cs4">222 [nF]</option>
                        </select>
                        <div class="error-tooltip" id="error-cs">Please select a capacitance value</div>
                    </div>
                    
                    <!-- Resistance (R1s or R2r) -->
                    <div class="parameter-group" id="param-resistance" style="display: none;">
                        <label for="select-resistance">Resistance (R1s or R2r):</label>
                        <select id="select-resistance" class="param-select">
                            <option value="">Select resistance...</option>
                            <optgroup label="R1s options">
                                <option value="r1s1">4.9 [Œ©]</option>
                                <option value="r1s2">56.8 [Œ©]</option>
                                <option value="r1s3">739 [Œ©]</option>
                                <option value="r1s4">26.9 [kŒ©]</option>
                            </optgroup>
                            <optgroup label="R2r options">
                                <option value="r2r1">14.9 [Œ©]</option>
                                <option value="r2r2">32.9 [Œ©]</option>
                                <option value="r2r3">4.91 [kŒ©]</option>
                                <option value="r2r4">47.4 [kŒ©]</option>
                            </optgroup>
                        </select>
                        <div class="error-tooltip" id="error-resistance">Please select a resistance value</div>
                    </div>
                    
                    <!-- Discharge Resistor (Optional) -->
                    <div class="parameter-group" id="param-discharge" style="display: none;">
                        <label for="select-discharge">Discharge Resistor (Rz) - Optional:</label>
                        <select id="select-discharge" class="param-select">
                            <option value="">Select discharge resistor...</option>
                            <option value="rz1">3 [Œ©]</option>
                            <option value="rz2">21.7 [Œ©]</option>
                            <option value="rz3">357 [Œ©]</option>
                            <option value="rz4">2.18 [kŒ©]</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Measurement Control Section (shown when circuit is selected) -->
            <div class="measurement-section" id="measurementSection" style="display: none;">
                <h3>üìä Measurement Control</h3>
                <p class="measurement-subtitle">Configure measurement parameters and start data acquisition</p>
                
                <!-- Buffer Size Warning -->
                <div class="buffer-warning" id="bufferWarning" style="display: none;">
                    <span class="warning-icon">‚ö†Ô∏è</span>
                    <div class="warning-content">
                        <strong>Buffer Size Too Small!</strong>
                        <p>Your current buffer size (<span id="warningCurrentBuffer">0</span> samples) is insufficient for the selected sample rate and measurement time.</p>
                        <p>The system will automatically use <strong><span id="warningCalculatedBuffer">0</span> samples</strong> instead to prevent buffer overflow errors.</p>
                    </div>
                </div>
                
                <div class="measurement-inputs">
                    <div class="input-row">
                        <div class="input-group">
                            <label for="input-samples">Samples per Channel:</label>
                            <input type="number" id="input-samples" class="measurement-input" 
                                   value="500" min="100" max="100000" step="10">
                            <div class="error-tooltip" id="error-samples">Value must be between 100 and 100.000</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="input-sample-rate">Sample Rate (Hz):</label>
                            <input type="number" id="input-sample-rate" class="measurement-input" 
                                   value="100" min="1" max="100000" step="1">
                            <div class="error-tooltip" id="error-sample-rate">Value must be between 1 and 100.000 Hz</div>
                        </div>
                        
                        <div class="input-group">
                            <label for="input-measurement-time">Measurement Time (s):</label>
                            <input type="number" id="input-measurement-time" class="measurement-input" 
                                   value="5" min="0.01" max="10" step="0.01" 
                                   placeholder="Auto stop time">
                            <div class="error-tooltip" id="error-measurement-time">Value must be between 0.01 and 10 seconds</div>
                        </div>
                    </div>
                    
                    <div class="button-row">
                        <button class="measurement-btn btn-start" id="btnStartMeasurement" onclick="startMeasurement()" 
                                data-tooltip="Please select all required parameters">
                            ‚ñ∂Ô∏è Start Measurement
                        </button>
                        <button class="measurement-btn btn-stop" id="btnStopMeasurement" onclick="stopMeasurement()" 
                                data-tooltip="No active measurement to stop" disabled>
                            ‚èπÔ∏è Stop Measurement
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section (shown during/after measurement) -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>üìä Measurement Results</h2>
            <p class="results-subtitle">Real-time data acquisition from selected channels</p>
            
            <div class="results-controls">
                <button class="result-btn btn-save" id="btnSaveJSON" onclick="saveResultsJSON()">
                    üíæ Save Results to JSON
                </button>
                <button class="result-btn btn-save-csv" id="btnSaveCSV" onclick="saveResultsCSV()">
                    üìÑ Save Results to CSV
                </button>
                <button class="result-btn btn-clear" id="btnClearResults" onclick="clearResults()">
                    üóëÔ∏è Clear Results
                </button>
            </div>
            
            <div class="charts-grid" id="chartsGrid">
                <!-- Charts will be dynamically inserted here based on circuit type -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="/static/logopg.svg" alt="Gda≈Ñsk University of Technology Logo" class="pg-logo">
            </div>
            
            <div class="footer-info">
                <div class="footer-section">
                    <h4>NI DAQ Control Dashboard</h4>
                    <p>Website for Data Acquisition from NI DAQ Module</p>
                </div>
                
                <div class="footer-section">
                    <h4>Author</h4>
                    <p><strong>Illia Shcheboruk</strong></p>
                    <p>Gda≈Ñsk University of Technology</p>
                    <p>Faculty of Electrical and Control Engineering</p>
                </div>
                
                <div class="footer-section">
                    <h4>Project Information</h4>
                    <p>Release Date: <strong>TODO</strong></p>
                    <p>Version: 1.0.0</p>
                    <p>Engineering Thesis Project</p>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2024-2025 Illia Shcheboruk. All rights reserved.</p>
            <p>Developed as part of Bachelor's Engineering Thesis</p>
        </div>
    </footer>
    
    <!-- External JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
